<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Oswald" rel="stylesheet">
    <script src="https://use.typekit.net/ptv3liz.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta property="og:image" content="window.url"/>
    <meta property="og:description"    content="Politics Illustrated." />
    <meta property="og:image:width"    content="600px" />
    <meta property="og:image:height"    content="1000px" />
    <title>Make America Doodle Again</title>
    <script src="js/canvas-to-blob.min.js"></script>
    <script src="https://fb.me/react-0.14.7.min.js"></script>
    <script src="https://fb.me/react-dom-0.14.7.min.js"></script>
    <!--<script src="https://unpkg.com/react@15.3.2/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script>
    <!--<script src="js/dropzone.js"></script>-->
    <!--<script src = "https://cdnjs.cloudflare.com/ajax/libs/babel-core/6.1.19/browser.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="js/sketch.js"></script>
    
    <style>@import url(http://fonts.googleapis.com/css?family=Shadows+Into+Light);
    


    body,html{
        font-family:Bebas Neue;
        letter-spacing:2px;
        background:url('img/Backgroundx2.png');
        width:100%;
        height:100%;
        position:absolute;
        margin:0px;
        overflow-x:hidden;
        overflow-y:visible;
    }
    
    
    
    #candidate{
        position: relative;
        width: 160px;
        margin:auto;
        height:160px;
        font-size:40px;
        text-align:center;
        margin-top:40px;
        border:3px solid #492E8D;
        border-radius:200px;
    }

    #candidate[candidate="Hillary"]{
        background:url('img/Clinton.png') no-repeat center center;
        background-size:contain;
    }

    #candidate[candidate="Donald"]{
        background:url('img/Trump.png') no-repeat center center;
        background-size:contain;
    }

    #candidate[candidate="Jill"]{
        background:url('img/Stein.png') no-repeat center center;
        background-size:contain;
    }

    #candidate[candidate="Gary"]{
        background:url('img/Johnson.png') no-repeat center center;
        background-size:contain;
    }
    
    
    #issue{
        position: relative;
        width: 100%;
        max-width:400px;
        margin:auto;
        height:30px;
        font-size:30px;
        text-align:center;
        color:#FE4841;
        margin-top:40px;
        margin-bottom:0px;
    }

    #candidateName{
        position: relative;
        width: 100%;
        max-width:400px;
        margin:auto;
        height:30px;
        font-size:30px;
        text-align:center;
        color:#FE4841;
        margin-top:30px;
        margin-bottom:0px;
    }
    
    #draw{
        position: relative;
        width: 100%;
        max-width:400px;
        margin:auto;
        height:10px;
        font-size:50px;
        text-align:center;
        margin-top:10px;
        padding: 20px 0px;
        margin-bottom:40px;
        color:#492E8D;
    }
    
    #stance{
        position: relative;
        width: 100%;
        max-width:400px;
        margin:auto;
        height:10px;
        font-size:50px;
        text-align:center;
        padding: 20px 0px;
        margin-bottom:20px;
        margin-top:0px;
        color:#492E8D;
    }
    
    #stop{
        margin: auto;
        display: block;
        width: 150px;
        text-align: center;
        height: 60px;
        border-radius: 100px;
        background: black;
        line-height: 60px;
        color: white;
        background:#FE4841;
        margin-top:60px;
        font-size:30px;
    }
    
    #search{
        display: block;
        padding: 20px;
        width: 180px;
        text-align: center;
        margin: auto;
        color:#FE4841!important;
    }


   #browserDraw{
        display: block;
        padding: 20px;
        width: 180px;
        text-align: center;
        margin: auto;
        color:#FE4841!important;
    }

    
    #doodle{
        margin: auto;
        display: block;
        width: 220px;
        text-align: center;
        height: 60px;
        border-radius: 100px;
        background: black;
        line-height: 60px;
        color: white;
        background:#FE4841;
        margin-top:0px;
        font-size:30px;
    }
    
    #fullStance{
        text-align: center;
        margin: auto;
        max-width: 300px;
        width: 100%;
        font-size: 40px;
        background: #FE4841;
        padding: 20px;
        color: white;
        position:relative;
        top:100px;
        font-style:italic;
    }

    #fullStance>span{
        font-weight:bold;
        font-style:normal;
    }
    
    #back{
        padding:20px;
    }
    
    #timer{
        text-align:center;
        font-size: 80px;
        margin-bottom:70px;
        color:white;
    }
    
    #done{
        margin:auto;
        text-align: center;
        bottom:40px;
        position: relative;
        padding: 20px;
        width: 60px;
        border-radius: 60px;
        color: white;
        background:#FE4841;
    }

     #doneDrawing{
        margin-left:-45px;
        left:50%;
        text-align: center;
        bottom:40px;
        position: absolute;
        padding: 20px;
        background: black;
        width: 60px;
        border-radius: 60px;
        color: white;
        background:#FE4841;
    }

     #doneDrawing{
        margin-left:-45px;
        left:50%;
        text-align: center;
        bottom:40px;
        position: absolute;
        padding: 20px;
        background: black;
        width: 60px;
        border-radius: 60px;
        color: white;
        background:#FE4841;
    }
    
    #replay{
        padding:20px;
        margin:20px auto;
        background:#FE4841;
        color:white;
        border-radius:50px;
        width:100px;
        text-align:center;
    }
    
    #shareit{
        padding:20px;
        margin:auto;
        background:#FE4841;
        color:white;
        border-radius:50px;
        width:100px;
        text-align:center;
        margin-top:100px;
    }

    #mainNav{
        left:0px;
        height:50px;
        position:absolute;
        z-index:100000;
        background:url('img/HamburgerMenux2.png') right center no-repeat;
        background-size:20px;
        right:10px;
    }

    #logo{
        position:absolute;
        left:10px;
        height:100%;
        background:white;
        width:30px;
        background:url('img/LogoSmallx2.png') no-repeat center center;
        background-size:contain;
    }

    #menu{
        position:absolute;
        right:20px;
        height:100%;
    }

    #menu>a>div{
        float:right;
        margin:0px 10px;
        line-height:50px;
        color:white!important;
    }

    #purpleBG{
        width:300%;
        height:200%;
        top:320px;
        margin-left:-100%;
        transform:rotate(15deg);
        background:#472094;
        position:absolute;
        z-index:0;
    }

    #chooseScreen, #drawScreen, #shareScreen{
        position:absolute;
        z-index:1;
        height:100%;
        top:0px;
        width:100%;
    }

    #landingPage{
        height:100%;
        width:100%;
        position:absolute;
        overflow:hidden;
    }

    #OrDrawInBrowser{
        margin:auto;
        color:#FE4841;
        text-align:center;
    }

    #drawinBrowser{
        position:absolute;
        width:100%;
        height:100%;
        top:0px;
            z-index: 100000;
            background:rgba(0,0,0,.9);
    }

    #simple_sketch{
        top:20px;
        background: white;
        box-shadow: 0px 0px 10px rgba(0,0,0,.2);
        margin: auto;
        position: absolute;
        left: 50%;
        margin-left: -150px;
        width:300px!important;
        height:500px!important;
    }

    #doodleUploadWrap {
        position: relative;
        overflow: hidden;
        background: #FE4841;
        border-radius: 100px;
        margin: 10px auto;
        padding: 10px;
        width: 160px;
        text-align: center;
    }
    #doodleUploadWrap input {
        position: absolute;
        top: 0;
        right: 0;
        margin: 0;
        padding: 0;
        font-size: 20px;
        cursor: pointer;
        opacity: 0;
        filter: alpha(opacity=0);
    }

    @media screen and (max-width: 500px) {
        #stop {
            width:100%;
            position:fixed;
            bottom:0px;
            left:0px;
            border-radius:0px;
        }

        #doodle {
            width:100%;
            position:fixed;
            bottom:0px;
            left:0px;
            border-radius:0px;
        }
    }

    
    </style>
</head>
<body>


    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '1658046067839869',
          xfbml      : true,
          version    : 'v2.8'
        });
        FB.AppEvents.logPageView();
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    </script>


    <div id = "landingPage">
        <nav id = "mainNav">
            <div id = "logo"></div>
            <div id = "menu">
                <a href = "app.html"><div id = "play">Play</div></a>
                <a href = "about.html"><div id = "about">About</div></a>
            </div>
        </nav>
    </div>
    <div id = "chooseScreen">

        <div id="candidate">
            
        </div>

        <div id = "draw">DOODLE</div>
        
        <div id="candidateName">
            Trump
        </div>
        
        <div id = "stance">STANCE ON</div>
        
            
        <div id="issue">
            
        </div>
        
        <div id = "stop">Stop</div>
        
        <a target="_BLANK" id = "search" href = "google.com">What is their stance?</a>
        
        <div id = "doodle">Doodle It!</div>
    </div>

    <div id = "drawScreen">
        <div id = "fullStance"></div>
        <p style = "text-align:center; padding:20px; padding-top:120px; color:white; margin:auto; width:100%; max-width:200px;">Quick! find some paper and start doodling!</p>
        <div id = "OrDrawInBrowser">Or, draw in the browser</div>
        <div id = "timer">4:00</div>
        <div id="doodleUploadWrap">Upload Doodle
            <input id="doodleUpload" type = "file"/>
        </div>
        <div id = "done">Done</div>
    </div>

    <div id = "drawinBrowser">
        
        <!-- sketching in browser -->
        <canvas id="simple_sketch" width="300" height="500"></canvas>
        <script type="text/javascript">
        $(function() {
        $('#simple_sketch').sketch();
        });
        </script>
        <a download="doodle.jpg" id = "doneDrawing">Done</a>

        

    </div>



    <div style = "display:none;" id = "drawScreen_old">
        <div id = "fullStance"></div>
        <p style = "text-align:center; padding:20px; padding-top:120px; color:white; margin:auto; width:100%; max-width:200px;">Quick! find some paper and start doodling!</p>
        <div id = "OrDrawInBrowser">Or, draw in the browser</div>
        <div id = "timer">4:00</div>
        <div id="doodleUploadWrap">Upload Doodle
            <input id="doodleUpload" type = "file"/>
        </div>
        <div id = "done">Done</div>
    </div>


    <div id = "shareScreen">
        <div id = "shareit">Share it!</div>
        <div id = "replay">Replay?</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>

    <script>
    // Initialize Firebase
    var config = {
    apiKey: "AIzaSyBU2gpSPOXQud13jn_XfG499tmnuARIJdI",
    authDomain: "makeamericadoodleagain.firebaseapp.com",
    databaseURL: "https://makeamericadoodleagain.firebaseio.com",
    storageBucket: 'gs://makeamericadoodleagain.appspot.com/',
    messagingSenderId: "26288147536"
    };
    firebase.initializeApp(config);
    </script>
    
    <script>
    var candidates = ['Hillary Clinton','Donald Trump','Jill Stein','Gary Johnson'];
    var candidatesShort = ['Hillary','Donald','Jill','Gary'];
    var issues = ['Fracking','Drug War','Private Prisons','Death Penalty','Student Debt','Standing Rock Protestors','Recreational Cannabis','Drinking Age','Voting requirements','Felon Voting Rights','Third-Party Candidates','LGBTQ Rights','Torture Techniques','NSA Surveillance','Military Budget','Military Intervention/ ISIS Intervention','Millenials','US-Russia Relations','Gender Identity','Trans Pacific Partnership','Free College','Black Lives Matter','Global Warming','China, China, China','Police Brutality','Planned Parenthood','Guns','Obamacare','Building the Wall','Minimum Wage','Big Pharma','Refugees','Social Security','Tax Increase','Corporate Tax','Smoking a Doobie','Size of the Government','NSA surveillance','Edward Snowden','Miss Universe','Breaking Up The Banks','Net Neutrality','Their Opponents Hair'];
    currIssueId = Math.floor(Math.random()*issues.length);
    currCandidateId = 0;
    $(document).ready(function(){
                
                setTimeout(function(){
                    var canvas = document.getElementById("simple_sketch");
                    var ctx = canvas.getContext("2d");
                    ctx.fillStyle = "white";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                },1000);
                
                
                showChooseScreen();
                
                $("#stop").click(function(){
                    $("#stop").hide();
                    clearInterval(roulette);
                    $('#search').attr('href','http://www.google.com/search?q='+candidates[currCandidateId]+'+stance+on+'+issues[currIssueId]+'&btnG').show();
                    $('#doodle').show();
                });
                
                $('#doodle').click(function(){
                    showDoodleScreen(); 
                });
                
                var key = null;

                function doneDrawing(){
                   $('#drawinBrowser').hide();
                   if(window.doodleFileUpload){
                    console.log('good to go!!!!!!!');
                   }
                   var postListRef = firebase.database().ref('doodles');
                   var newPostRef = postListRef.push();
                    newPostRef.set({
                        url:"doodle"
                    });
                    var key = newPostRef.key;
                    window.key = key;

                    var canvas = document.getElementById("simple_sketch");
                    //var dt = canvas.toDataURL('image/png');
                    var dt = canvas.toBlob(function(blob){

                    

                    var storageRef = firebase.storage().ref().child("doodles/"+key+".png");
                    
                    var firstFile = blob;

                    if(window.doodleFileUpload){
                        firstFile = window.doodleFileUpload;
                    }

                    var uploadTask = storageRef.put(firstFile).then(function(snapshot){

                        var thisUrl = storageRef.getDownloadURL().then(function(url){
                            console.log(url);
                            window.url = url;
                            newPostRef.set({
                                url:key,
                                fullURL:url
                            });
                        });

                        

                        
                    });



                   },'image/png');


                   //this.href = dt;

                   
                   /*
                    var storageRef = firebase.storage.ref("folderName/file.jpg");
                    var fileUpload = document.getElementById("fileUpload");
                    fileUpload.on(‘change’, function(evt) {
                      //var firstFile = evt.target.file[0]; // get the first file uploaded
                      var firstFile = dt;
                      var uploadTask = storageRef.put(firstFile);
                    });*/

                };

                document.getElementById('doneDrawing').addEventListener('click',doneDrawing,false);

                $('#done').click(function(){
                    showShareScreen(); 

                });
                
                $('#replay').click(function(){
                   showChooseScreen(); 
                });

                $('#shareit').click(function(){
                showFbDialogue(); 
                });

                function showFbDialogue(){
                    console.log(window.url);
                    FB.ui({
                        method: 'feed',
                        mobile_iframe: true,
                        link: 'https://www.makeamericadoodleagain.com',
                        picture: window.url,

                        caption: 'test testtest'
                      }, function(response){});              
                }

                
                var roulette;
                
                function showChooseScreen(){
                    $('#drawinBrowser').hide();
                    $('#shareScreen').hide();
                    $('#chooseScreen').show();
                    $('#search').hide();
                    $('#doodle').hide();
                    $('#drawScreen').hide();
                    $('#shareScreen').hide();
                    $("#stop").show();
                    roulette = setInterval(function(){
                        currIssueId++;
                        if(currIssueId > issues.length-1){
                            currIssueId = 0;
                        }
                       $('#issue').html(issues[currIssueId]);
                       currCandidateId++;
                        if(currCandidateId > candidates.length-1){
                            currCandidateId = 0;
                        }
                       $('#candidate').attr('candidate',candidatesShort[currCandidateId]);
                    },120);
                }

                var inputElement = document.getElementById('doodleUpload');
                inputElement.onchange = function(event) {
                   var fileList = inputElement.files;
                   window.doodleFileUpload = fileList[0];
                   doneDrawing();
                   //TODO do something with fileList.  
                }

                    
                function showShareScreen(){
                    $('#drawScreen').hide();
                    $('#shareScreen').show();
                    clearInterval(timer);
                }

                function showDoodleScreen(){
                    $('#fullStance').html('Doodling <span>'+candidates[currCandidateId]+"\'s</span> stance on <span>"+issues[currIssueId]+"</span");
                    $('#chooseScreen').hide();
                    $('#drawScreen').show();
                    startDoodleTimer();
                }

                $("#OrDrawInBrowser").click(function(){
                    showDoodleInBrowser();
                });

                function showDoodleInBrowser(){
                    $('#drawinBrowser').show();
                }
                
                var timer;
                function startDoodleTimer(){
                    var time = 240;
                    var minutes = time/60;
                    timer = setInterval(function(){
                        if(time<0){
                            clearInterval(timer);
                            return;
                        }
                        time--;
                        minutes = Math.floor(time/60);
                        $('#timer').html(minutes+":"+time%60);
                    },1000);
                }
    });
            
    </script>
        
</body>
</html>




